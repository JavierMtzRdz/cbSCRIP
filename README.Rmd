---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

## Packages to use ----
pacman::p_load(
  tidyverse, janitor, writexl,
  readxl, scales, mytidyfunctions
)

## Set theme ------
mytidyfunctions::set_mytheme()

options(
  ggplot2.discrete.colour = c("#277DA1", "#f94144", "#F9C74F", "#43AA8B"),
  ggplot2.discrete.fill = c("#277DA1", "#f94144", "#F9C74F", "#43AA8B")
)
```

# cbSCRIP: Case-Base Sampling for Sparse Competing Risk Prediction

<!-- badges: start -->
<!-- badges: end -->

## Overview

`cbSCRIP` implements an estimator based on **case-base sampling** for sparse competing risk prediction. It uses an elastic-net penalized multinomial approach with an offset parameter, enabling both accurate prediction and variable selection under competing risks. This approach allows for efficient estimation of cause-specific hazards in high-dimensional settings.

## Installation

You can install the development version of `cbSCRIP` from [GitHub](https://github.com/JavierMtzRdz/cbSCRIP):

```{r eval=FALSE}
# Install remotes if needed
# install.packages("remotes")
remotes::install_github("JavierMtzRdz/cbSCRIP")
```

## Quick Start

```{r}
library(cbSCRIP)
library(survival)

# Generate synthetic competing risks data
set.seed(123)
n <- 200
p <- 20
num_true <- 5
data_list <- cbSCRIP::gen_data(n_train = n, p = p, num_true = num_true, setting = 1)
train <- data_list$train

# Fit a penalized case-base model
fit <- cbSCRIP(
  Surv(ftime, fstatus) ~ .,
  data = train,
  nlambda = 50,
  fit_fun = MNlogisticCCD,
  ratio = 20,
  coeffs = "original" 
)

# Summary 
fit

# Plot
plot(fit)

# Perform cross-validation to select the optimal lambda
cv_fit <- cv_cbSCRIP(
  Surv(ftime, fstatus) ~ .,
  data = train,
  nfold = 3,
  nlambda = 50,
  ratio = 20
)

# Summary 
cv_fit

# Plot
plot(cv_fit)
```

## Features

- Efficiently handles large-scale survival and competing risks data by transforming it into a multinomial framework.
- Supports **Lasso** and **Elastic-Net** penalties for variable selection in high-dimensional datasets ($p > n$).
- **Optimizers**:
  - `MNlogisticCCD`: Cyclical Coordinate Descent (efficient for sparse paths).
  - `MNlogisticSAGAN`: Stochastic Average Gradient (SAGA) with Nesterov acceleration.
  - `MNlogisticSVRG`: Stochastic Variance Reduced Gradient.

## License

MIT + file LICENSE
